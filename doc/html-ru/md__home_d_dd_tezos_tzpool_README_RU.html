<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pool Games: Контракты периодического розыгрыша вознаграждений на депозитных пулах в фермах</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Pool Games
   </div>
   <div id="projectbrief">Розыгрыши вознаграждения на основе смарт-контрактов Tezos</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Создано системой Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Поиск','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Поиск');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__home_d_dd_tezos_tzpool_README_RU.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Контракты периодического розыгрыша вознаграждений на депозитных пулах в фермах </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/dimdim1177/tezos-pool-games">https://github.com/dimdim1177/tezos-pool-games</a> Полный код и документация контрактов на периодические розыгрыши вознаграждений на депозит из пулов в фермах Crunchy или Qupipuswap. Проект разработан на Debian 11, не тестировался на других ОС.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Начало работы</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Установка инструментов</h2>
<p>Выполнить скрипт <code>./install/install_all.sh</code> для скачивания и установки: LIGO, tezos-client, python, pytezos и т.д. Или выполните скрипты ./install/install_*.sh для каждого инструмента вручную.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Компилирование</h2>
<p>Использование: compile.sh NAME|ALL Скомпилируйте 'contracts/NAME.ligo' или 'contracts/*.ligo' для ALL. Скомпилированные файлы сохраняются в файлах build/NAME.tz и build/NAME.storage.tz.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Тестирование</h2>
<p>Использование: tests.sh NAME|ALL Исполняет тесты из 'tests/NAME.ligo' или 'tests/*.ligo' для ALL. Логи тестирования сохраняются в файлах build/NAME.test.log.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Развертывание</h2>
<p>Использование: deploy.sh NAME|ALL [force] Развертывание 'build/NAME.tz', инициализированное «build/NAME.storage.tz» (или «build/*.tz» для ALL), с помощью учетной записи, сохраненной как owner в tezos-client.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Документация</h2>
<p>Во-первых, установите подмодули с помощью <code>git submodule update --init --recursive</code>. Затем выполните скрипт <code>./doc/doc.sh</code>, чтобы сгенерировать английскую и русскую документацию к контрактам. Код использует скрипты подпроектов, прикрепленных как подмодули git:</p><ul>
<li><a href="https://github.com/dimdim1177/mlcomment">https://github.com/dimdim1177/mlcomment</a> Многоязычные комментарии</li>
<li><a href="https://github.com/dimdim1177/ligo2dox">https://github.com/dimdim1177/ligo2dox</a> Преобразование PascaLIGO в как бы C++ код для автоматического документирования с помощью Doxygen</li>
</ul>
<h1><a class="anchor" id="autotoc_md7"></a>
Контракты</h1>
<h2><a class="anchor" id="autotoc_md8"></a>
Контракт с пулами</h2>
<p>См. Contracts/CPoolGames.ligo и папку Contracts/CPoolGames. Основные характеристики:</p><ul>
<li>Поддержка 2 интерфейсов ферм: Crunchy и QUIPU</li>
<li>Три алгоритма определения победителя:<ul>
<li>Вероятность выигрыша пропорциональна времени в текущей игре</li>
<li>Вероятность выигрыша пропорциональна сумме времени * депозита в текущей игре</li>
<li>Равные вероятности для всех пользователей в пуле</li>
</ul>
</li>
<li>Дополнительные опции пула:<ul>
<li>минимальный депозит</li>
<li>минимальные секунды в игре</li>
<li>максимальный депозит (только для алгоритма по сумме время * депозит)</li>
<li>процент выигрыша, процент сжигания, процент вознаграждения</li>
<li>токен для сжигания, адрес комиссии</li>
</ul>
</li>
<li>Гибкое конфигурирование кода (см. <a class="el" href="CPoolGames_2config_8ligo.html" title="Конфигурация контракта (ключи компиляции)">contracts/CPoolGames/config.ligo</a>):<ul>
<li>владелец/администраторы пула или пул-как-услуга</li>
<li>можно включить безопасную перечисление токенов (удалить оператора после перечисления)</li>
<li>можно включить статистику пула в блокчейне для продвижения</li>
<li>можно включить views пула для других смарт-контрактов</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Контракт для генерации случайных чисел</h2>
<p>См. Contracts/CRandom.ligo и папку Contracts/CRandom. Основные характеристики:</p><ul>
<li>Любой может запросить случайное число в будущем</li>
<li>Запрос содержит адрес и идентификатор объекта</li>
<li>Случайное число основано на хеше ближайшего блока Tezos с бОльшим временем запроса и XOR с хэшем запроса, поэтому один блок Tezos генерирует разные случайные числа для разных запросов с одинаковым временем.</li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
Префиксы лексем</h2>
<ul>
<li><b>С</b> - Контракт</li>
<li><b>M</b> - Модуль</li>
<li><b>t_</b> - Тип</li>
<li><b>c</b> - Константа</li>
<li><b>cERR_</b> - Константа с кодом ошибки для failwith</li>
</ul>
<h1><a class="anchor" id="autotoc_md11"></a>
Дерево папок</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
contracts</h2>
<p>Папка с кодом контрактов. Файлы по маске contracts/CONTRACT_NAME.ligo скомпилированы как контракты. Папка contracts/CONTRACT_NAME, используемая для конкретных контрактов и модулей. Файл contracts/CONTRACT_NAME/config.ligo содержит определения конфигурации контракта. Файл contracts/CONTRACT_NAME/initial_storage.ligo содержит описание начального хранилища.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
contracts/include</h3>
<p>Общие include для всех контрактов.</p>
<h3><a class="anchor" id="autotoc_md14"></a>
contracts/module</h3>
<p>Общие модули для всех контрактов.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
contracts/CPoolGames</h3>
<p>Include и модули для контракта <a class="el" href="CPoolGames_8ligo.html">contracts/CPoolGames.ligo</a>.</p>
<h3><a class="anchor" id="autotoc_md16"></a>
contracts/CRandom</h3>
<p>Include и модули для контракта <a class="el" href="CRandom_8ligo.html">contracts/CRandom.ligo</a>.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
doc</h2>
<p>Папка с документацией. Файл algo.xlsx - сравнительная таблица изменения весов пользователей и партии в различных алгоритмах в различных ситуациях для упрощения понимания логики начисления весов.</p>
<h3><a class="anchor" id="autotoc_md18"></a>
html-ru</h3>
<p>Документация на английском языке, пожалуйста, откройте doc/html-en/index.html</p>
<h3><a class="anchor" id="autotoc_md19"></a>
html-ru</h3>
<p>Русскоязычная документация, пожалуйста, откройте doc/html-ru/index.html</p>
<h3><a class="anchor" id="autotoc_md20"></a>
doc/ligo2dox</h3>
<p><a href="https://github.com/dimdim1177/mlcomment">https://github.com/dimdim1177/mlcomment</a> Многоязычные комментарии</p>
<h3><a class="anchor" id="autotoc_md21"></a>
doc/ligo2dox</h3>
<p><a href="https://github.com/dimdim1177/ligo2dox">https://github.com/dimdim1177/ligo2dox</a> Преобразование PascaLIGO в C++ как код для автоматического документирования с помощью Doxygen</p>
<h2><a class="anchor" id="autotoc_md22"></a>
accounts</h2>
<p>Папка с файлами аккаунтов *.json, загруженными с <a href="https://teztnets.xyz/">https://teztnets.xyz/</a>, базовое имя файла используется как имя учетной записи в tezos-client. Один из них должен называться owner.json, эта учетная запись используется для развертывания контрактов. Скрипт <code>accounts/activate.sh</code> активирует все учетные записи в тестовой сети.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
build</h2>
<p>Папка для скомпилированных файлов *.tz, логов *.log и т.д.</p>
<h2><a class="anchor" id="autotoc_md24"></a>
install</h2>
<p>Папка со скриптами для установки средств разработки: LIGO, tezos-client и так далее.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
tests</h2>
<p>Тесты на LIGO. См. файлы <code>tests/CPoolGames.ligo</code> и <code>tests/CRandom.ligo</code>.</p>
<h3><a class="anchor" id="autotoc_md26"></a>
tests/include</h3>
<p>Общий код тестирования.</p>
<h3><a class="anchor" id="autotoc_md27"></a>
tests/CPoolGames</h3>
<p>Код тестирования только для <a class="el" href="classCPoolGames.html" title="Контракт периодического розыгрышей вознаграждения на пулах депозитов в фермы">CPoolGames</a>.</p>
<h3><a class="anchor" id="autotoc_md28"></a>
tests/CRandom</h3>
<p>Код тестирования только для <a class="el" href="classCRandom.html" title="Контракт для РЕДКОЙ генерации случайного числа по запросу на основе блоков Тезос">CRandom</a>.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
tezbin</h2>
<p>Бинарники от tezos: tezos-client и так далее.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
venv</h2>
<p>Виртуальная среда для python </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Создано системой <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
